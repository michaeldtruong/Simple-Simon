<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Simon</title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
        <link href="/css/simon.css" rel="stylesheet">

    </head>
    <body>
            <div class="debug">
                <button id="playSequence">Play Sequence</button>
                <div class="displayHealth"></div>
                <div class="displayEnergy"></div>
                <div class="displayHealthE"></div>
                <div class="displayEnergyEnemy"></div>
            </div>

        <div class="container">
            <div class="enemySide">
                <img src="/img/exodus.png" class="enemyShipImg">
            </div>
            <div class="enemyHud">
                <div class="maxHpBarEnemy">
                    <div class="currentHpBarEnemy"></div>
                </div>
                <div class="maxEnergyBarEnemy">
                    <div class="currentEnergyBarEnemy"></div>
                </div>
                <div class="displayTempEnemy"></div>
                <img src="/img/tempcircle.jpg" class="tempcircleEnemy">
            </div>
            <div class="playerSide">
                <img src="/img/regalia1.png" class="playerShipImg">
            </div>

            <div class="hud">
                <div class="shipMain">
                    <div class="statusBox"></div>
                    <img src="/img/repeat.png" class="repeatImg">
                    <button class="repeat"></button>
                    <button class ="buttons" id="but1"></button>
                    <button class ="buttons" id="but2"></button>
                    <button class ="buttons" id="but3"></button>
                    <button class ="buttons" id="but4"></button>
                </div>
                <div class="weaponMenu"></div>
                <div class="battleLog"></div>
                <div class="playerStatus">
                    <div class="maxHpBar">
                        <div class="currentHpBar"></div>
                    </div>
                    <div class="maxEnergyBar">
                        <div class="currentEnergyBar"></div>
                    </div>
                    <div class="displayTemp"></div>
                    <img src="/img/tempcircle.jpg" class="tempcircle">
                </dv>
            </div>

        </div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script   src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"   integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E="   crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <script>
            "use strict";

            var ships = [
                {
                    "name": "Regalia",
                    "maxHp": 1200,
                    "hp": 1200,
                    "maxEnergy": 10,
                    "energy": 10,
                    "speed": 1000,
                    "engineTemp": 1,
                    "image": "<img src='/img/regalia1.png' id='regaliaImg'>",
                    "weapons": [
                        {
                            "name": "Force-Coolant",
                            "damage": 0,
                            "energyCost": 3,
                            "heatGeneration": 0,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                if (ships[0].engineTemp <= 3) {
                                    ships[0].engineTemp = 1;
                                } else {
                                ships[0].engineTemp -= 3;
                                }
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            }
                        }, {
                            "name": "Restore-Energy",
                            "damage": 0,
                            "energyCost": 0,
                            "heatGeneration": 0,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                if (ships[0].energy >= 7) {
                                    ships[0].energy = 10;
                                } else {
                                ships[0].energy += 3;
                                }
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            }
                        }, {
                            "name": "Proton-Cannon",
                            "damage": 300,
                            "energyCost": 2,
                            "heatGeneration": 3,
                            "castingTime": 2,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Player: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            } 
                        }, {
                            "name": "Rail-Gun",
                            "damage": 50,
                            "energyCost": 1,
                            "heatGeneration": 1,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Player: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            }
                        }, {
                            "name": "Barrier",
                            "damage": 0,
                            "energyCost": 2,
                            "heatGeneration": 0,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Player: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            }
                        }
                    ]

                }, {
                    "name": "Exodus",
                    "maxHp": 1700,
                    "hp": 1700,
                    "energy": 10,
                    "maxEnergy": 10,
                    "speed": 1500,
                    "engineTemp": 1,
                    "image": "<img src='/img/exodus.png' id='exodusImg'>",
                    "weapons": [
                        {
                            "name": "Force-Coolant",
                            "damage": 0,
                            "energyCost": 3,
                            "heatGeneration": 0,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                if (ships[1].engineTemp <= 3) {
                                    ships[1].engineTemp = 1;
                                } else {
                                ships[1].engineTemp -= 3;
                                }
                            },
                            "animation": function() {
                                console.log("Enemy: " + this.name + " animation");
                            }
                        }, {
                            "name": "Restore-Energy",
                            "damage": 0,
                            "energyCost": 0,
                            "heatGeneration": 0,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                if (ships[1].energy >= 7) {
                                    ships[1].energy = 10;
                                } else {
                                ships[1].energy += 3;
                                }
                            },
                            "animation": function() {
                                console.log("Player: " + this.name + " animation");
                            }
                        }, {
                            "name": "Proton-Cannon",
                            "damage": 300,
                            "energyCost": 2,
                            "heatGeneration": 3,
                            "castingTime": 2,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Enemy: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Enemy: " + this.name + " animation");
                            } 
                        }, {
                            "name": "Rail-Gun",
                            "damage": 50,
                            "energyCost": 1,
                            "heatGeneration": 1,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Enemy: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Enemy: " + this.name + " animation");
                            }
                        }, {
                            "name": "Particle-Ray",
                            "damage": 150,
                            "energyCost": 2,
                            "heatGeneration": 1,
                            "castingTime": 0,
                            "coolDown": 0,
                            "special": function() {
                                console.log("Enemy: " + this.name + " special");
                            },
                            "animation": function() {
                                console.log("Enemy: " + this.name + " animation");
                            }
                        }
                    ]
                }
            ];

            var playerShip = 0;
            var enemyShip = 1;
            var sequence = [];
            var speed = 400;
            var iteration = 1;
            var enemyTurnCounter = 5;
            var enemyTurnCounterRestart = 5;
            var enemyTurnTimer;
            var input;

            function disableInput() {
                document.getElementsByClassName("repeat")[0].disabled = true;
                document.getElementsByClassName("buttons")[0].disabled = true;
                document.getElementsByClassName("buttons")[1].disabled = true;
                document.getElementsByClassName("buttons")[2].disabled = true;
                document.getElementsByClassName("buttons")[3].disabled = true;
            }

            function enableInput() {
                document.getElementsByClassName("repeat")[0].disabled = false;
                document.getElementsByClassName("buttons")[0].disabled = false;
                document.getElementsByClassName("buttons")[1].disabled = false;
                document.getElementsByClassName("buttons")[2].disabled = false;
                document.getElementsByClassName("buttons")[3].disabled = false;  
            }

            function outputSequence(step) {
                switch (step) {
                    case 1:
                     $("#but1").animate({
                        opacity: "0.3"
                     }, 200).animate({
                        opacity: "1"
                     }, 200);
                     break;
                     case 2:
                     $("#but2").animate({
                        opacity: "0.3"
                     }, 200).animate({
                        opacity: "1"
                     }, 200);
                     break;
                     case 3:
                     $("#but3").animate({
                        opacity: "0.3"
                     }, 200).animate({
                        opacity: "1"
                     }, 200);
                     break;
                     case 4:
                     $("#but4").animate({
                        opacity: "0.3"
                     }, 200).animate({
                        opacity: "1"
                     }, 200);
                     break;
                }
            }

            function checkInput(input) {
                $("#but" + input).animate({
                        opacity: "0.3"
                     }, 200).animate({
                        opacity: "1"
                     }, 200);
                if (input == sequence[0]) {
                    sequence.shift(sequence[0]);
                    console.log(sequence);
                    document.getElementsByClassName("repeat")[0].disabled = true;
                } else {
                    console.log("wrong");
                } if (sequence.length == 0) {
                    disableInput();
                    drawWeaponMenu();
                    clearInterval(enemyTurnTimer);
                }
            }

            function startSequence() {
                $(".statusBox").animate({
                    backgroundColor: "yellow"
                    }, 70);
                disableInput();
                var step = Math.floor((Math.random() * 4) + 1);
                sequence.push(step);
                outputSequence(step);  
                console.log(sequence);
                if (iteration++ < ships[playerShip].engineTemp) {
                    setTimeout(startSequence, speed);
                } else if (iteration == ships[playerShip].engineTemp + 1) {
                    iteration = 1;
                    enableInput();
                    $(".statusBox").animate({
                        backgroundColor: "green"
                     }, 70);
                }
            }

            function repeatSequence() {
                $(".statusBox").animate({
                    backgroundColor: "yellow"
                    }, 70);
                disableInput();
                outputSequence(sequence[iteration - 1]);
                if (iteration++ < ships[playerShip].engineTemp) {
                    setTimeout(repeatSequence, speed);  
                } else if (iteration == ships[playerShip].engineTemp + 1) {
                    iteration = 1;
                    enableInput();
                    $(".statusBox").animate({
                        backgroundColor: "green"
                     }, 70);
                }
            }

            function drawStatus() {
                $(".displayTemp").html(ships[playerShip].engineTemp);
                $(".displayHealth").html("HP: " + ships[playerShip].hp);
                $(".displayHealthE").html("Enemy HP: " + ships[enemyShip].hp);
                $(".displayTempEnemy").html(ships[enemyShip].engineTemp);
                $(".displayEnergy").html("Energy: " + ships[playerShip].energy);
                $(".displayEnergyEnemy").html("Enemy Energy: " + ships[enemyShip].energy);
            }

            function drawWeaponMenu() {
                for (var i = 0; i < ships[playerShip].weapons.length; i++) {
                    $(".weaponMenu").append("<button class='weapons' id='" + ships[playerShip].weapons[i].name + "'>" + ships[playerShip].weapons[i].name + "</button>");
                    $(".weaponMenu").css("display", "block");
                    if (ships[playerShip].weapons[i].energyCost > ships[playerShip].energy) {
                        document.getElementById(ships[playerShip].weapons[i].name).disabled = true;
                    }
                }
                $(".weapons").click(function(e) {
                    for (var i = 0; i < ships[playerShip].weapons.length; i++) {
                        if ($(this).attr('id') == ships[playerShip].weapons[i].name) {
                            ships[enemyShip].hp -= ships[playerShip].weapons[i].damage;
                            ships[playerShip].energy -= ships[playerShip].weapons[i].energyCost;
                            ships[playerShip].engineTemp += ships[playerShip].weapons[i].heatGeneration;
                            ships[playerShip].weapons[i].special();
                            ships[playerShip].weapons[i].animation();
                            drawStatus();
                            $(".battleLog").append("<div>You use " + ships[playerShip].weapons[i].name + "</div>");
                            $(".weaponMenu").html("");
                            $(".weaponMenu").css("display", "none");
                            checkGameOver();
                            statusBars();
                            startSequence();
                            runEnemyTurn();
                        }
                    }
                });
            }

            function enemyTurn() {
                enemyTurnCounter--;
                var enemyChoice = Math.floor((Math.random() * (ships[enemyShip].weapons.length - 2)) + 2);
                if (ships[enemyShip].energy < 4 && enemyTurnCounter == 0) {
                    ships[enemyShip].weapons[1].special();
                    drawStatus();
                    $(".battleLog").append("<div>The enemy uses " +  ships[enemyShip].weapons[1].name + "</div>");
                    enemyTurnCounter = enemyTurnCounterRestart;
                } else if (ships[enemyShip].engineTemp > 6 && enemyTurnCounter == 0) {
                    ships[enemyShip].weapons[0].special();
                    drawStatus();
                    $(".battleLog").append("<div>The enemy uses " +  ships[enemyShip].weapons[0].name + "</div>");
                    enemyTurnCounter = enemyTurnCounterRestart;
                } else if (enemyTurnCounter == 0) {
                    ships[playerShip].hp -= ships[enemyShip].weapons[enemyChoice].damage;
                    ships[enemyShip].energy -= ships[enemyShip].weapons[enemyChoice].energyCost;
                    ships[enemyShip].engineTemp += ships[enemyShip].weapons[enemyChoice].heatGeneration;
                    ships[enemyShip].weapons[enemyChoice].special();
                    ships[enemyShip].weapons[enemyChoice].animation();
                    statusBars();
                    drawStatus();
                    $(".battleLog").append("<div>The enemy uses " + ships[enemyShip].weapons[enemyChoice].name + "</div>");
                    checkGameOver();
                    enemyTurnCounter = enemyTurnCounterRestart;
                }
            }

            function runEnemyTurn() {
                enemyTurnTimer = setInterval(enemyTurn, 300);
            }

            function statusBars() {
               var hpPercent = (ships[playerShip].hp / ships[playerShip].maxHp) * 100;
               $(".currentHpBar").animate({
                    height: hpPercent + "%"
                    }, 500);
               var energyPercent = (ships[playerShip].energy / ships[playerShip].maxEnergy) * 100;
               $(".currentEnergyBar").animate({
                    height: energyPercent + "%"
                    }, 500);
               var hpPercentEnemy = (ships[enemyShip].hp / ships[enemyShip].maxHp) * 100;
               $(".currentHpBarEnemy").animate({
                    height: hpPercentEnemy + "%"
                    }, 500);
               var energyPercentEnemy = (ships[enemyShip].energy / ships[enemyShip].maxEnergy) * 100;
               $(".currentEnergyBarEnemy").animate({
                    height: energyPercentEnemy + "%"
                    }, 500);

            }

            function checkGameOver() {
                if (ships[playerShip].hp <= 0) {
                    disableInput();
                    clearInterval(enemyTurnTimer);
                    $(".battleLog").append("<div>You Lose</div>");
                } else if (ships[enemyShip].hp <= 0) {
                    disableInput();
                    clearInterval(enemyTurnTimer);
                    $(".battleLog").append("<div>You Win</div>");
                }
            }

            disableInput();
            drawStatus();

            $("#but1").click(function(e) {
                checkInput(1);
            });
            $("#but2").click(function(e) {
                checkInput(2);
            });
            $("#but3").click(function(e) {
                checkInput(3);
            });
            $("#but4").click(function(e) {
                checkInput(4);
            });
            $("#playSequence").click(function(e) {
                startSequence();
                runEnemyTurn();
            });
            $(".repeat").click(function(e) {
                repeatSequence();
            });

        </script>
    </body>
</html>